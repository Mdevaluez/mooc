---
title: "mooc-lafitte-remi"
author: "Remi_Lafitte"
date: "14/01/2020"
output: html_document
---

### 1) Purpose of the analysis

Naive subject were asked to perform hand pointing, eyes closed, toward their body midline. Then, they realized a visuo-motor tracking task, where their goal was to track manually a virtual snake moving on a screen. One group was submitted to random force-fields generated by a robot arm (disturbed group). The second group experimented no disturbances (control group). Finally, they repeated the pointing task.  

We want to know if the body midline perception, assessed by the averaged absolute error (from 0 degree) is influenced by force-field disturbances. More precisely, we predict than the disturbed group will have greater absolute error in posttest than in pretest, whereas the control group will have identical performance in both posttest and pretest.

### 1) Downloading the data

We need some R packages 
```{r, include = F}
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidyr)
library(tidyverse)
library(nlme)
library(tibble)
library(patchwork)
library(sjPlot)
```




```{r}
data_url = "https://raw.githubusercontent.com/remi-lafitte/mooc/master/module3/data-pointing.csv"
```


```{r}
d = read.csv(data_url, sep = ",")
head(d)
```

### 2) Coding the variables of interest

We are interested in an interaction effect between the variables "group" (disturbed vs. control) and "session" (pretest vs. posttest). Because "session" is a within-subject variable, we will choose here to create a delta score that represents the variation of the absolute error between pretest and posttest. For this, I use the convenient fonction "lmList" of the package "nlme". 

```{r}
session_delta_1 = coef(lmList(score ~ 0 + session_c | subject, d)) 
```

Then I add the subject numbers to this dataframe.

```{r}
session_delta_2 <- session_delta_1 %>% 
  rownames_to_column("subject") %>% 
  mutate(subject = as.numeric(subject)) %>% 
  rename(session_delta = "session_c")
```

Finally I merge the first dataframe and the second dataframe we have just created, and call it "fit".
```{r}
fit <-d %>% 
  dplyr::select(subject, group_c, session, group) %>% 
  inner_join(session_delta_2, by = "subject") %>% 
  unique(.)
```

### 3) Descriptive statistics

First, we have to look graphically the shape of the interaction.

```{r}
d_mean <- 
  fit %>% 
  dplyr::group_by(group) %>% 
  dplyr::summarize(mean = mean(session_delta), sd = sd(session_delta)) %>%
  ungroup() %>% 
  mutate (
    lower_sd = mean - sd,
    upper_sd = mean + sd
  )

pd <- position_dodge(0.5)

p <- ggplot(d_mean, aes(group, mean, fill = group))
p +
  geom_col(position = "dodge", width = 0.50)+
  geom_errorbar(aes(ymin = lower_sd, ymax = upper_sd), width = 0.2, position = pd, size = 0.5) +
  geom_hline(yintercept = 0)+
  labs(x="Group", y= "Absolute error (in degree)")
```

As we can see, a clear interaction emerges as the delta score is negative in the control group, and positive in the disturbed group. This means that the control group has been more precise in posttest compared to pretest, and vice versa in the disturbed group. 


### 4) Inferential statistics

Is this interaction statistically significant ?

Let's first create our model :
```{r}
reg = lm (session_delta ~ group_c, fit)

```

And now we check the assumptions of the anova.

```{r}
plot(reg)
```

The assumptions seem satisfied. We can draw the inference :

```{r}
summary(reg)
```

Here, the group_c contrast represents in fact the interaction effect, which is not significant. 

### 5) Conclusion

Thus, we can't conclude that force-field disturbances have a detrimental impact on the body midline perception. It is noteworthy that the $R^2$ value ($0.02$) indicates a low effect size. 